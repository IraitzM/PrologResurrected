version: '3'

vars:
  PROJECT_NAME: prologresurrected
  PYTHON_VERSION: "3.13"

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list

  setup:
    desc: Set up the development environment
    cmds:
      - echo "ğŸ”§ Setting up development environment..."
      - uv sync
      - uv pip install -e .
      - echo "âœ… Development environment ready!"

  test:
    desc: Run all unit tests
    cmds:
      - echo "ğŸ§ª Running unit tests..."
      - uv run pytest tests/ -v --ignore=tests/e2e
      - echo "âœ… All tests passed!"

  test-watch:
    desc: Run tests in watch mode (re-run on file changes)
    cmds:
      - echo "ğŸ‘€ Running tests in watch mode..."
      - uv run pytest tests/ -v --tb=short -f

  lint:
    desc: Run code linting and formatting
    cmds:
      - echo "ğŸ” Running linter..."
      - uv run ruff check .
      - echo "ğŸ¨ Running formatter..."
      - uv run ruff format .
      - echo "âœ… Code linting and formatting complete!"

  lint-check:
    desc: Check code formatting without making changes
    cmds:
      - echo "ğŸ” Checking code format..."
      - uv run ruff check .
      - uv run ruff format --check .

  clean:
    desc: Clean up build artifacts and cache
    cmds:
      - echo "ğŸ§¹ Cleaning up..."
      - rm -rf build/
      - rm -rf dist/
      - rm -rf *.egg-info/
      - find . -type d -name __pycache__ -exec rm -rf {} +
      - find . -type f -name "*.pyc" -delete
      - echo "âœ… Cleanup complete!"

  build:
    desc: Build the package
    cmds:
      - echo "ğŸ“¦ Building package..."
      - uv build
      - echo "âœ… Package built successfully!"

  dev:
    desc: Start development server
    cmds:
      - echo "ğŸš€ Starting development server..."
      - uv run reflex run

  run:
    desc: Run the application
    cmds:
      - echo "ğŸš€ Running Logic Quest..."
      - uv run reflex run

  test-e2e:
    desc: Run end-to-end tests with Playwright
    cmds:
      - echo "ğŸ­ Running end-to-end tests..."
      - uv run playwright install --with-deps
      - uv run pytest tests/e2e/ -v
      - echo "âœ… E2E tests passed!"

  test-e2e-ui:
    desc: Run end-to-end tests with Playwright UI
    cmds:
      - echo "ğŸ­ Running E2E tests with UI..."
      - uv run playwright install --with-deps
      - uv run pytest tests/e2e/ --headed
      - echo "âœ… E2E tests completed!"

  test-all:
    desc: Run all tests (unit + E2E)
    deps: [test, test-e2e]
    cmds:
      - echo "âœ… All tests (unit + E2E) passed!"

  validate:
    desc: Run all validation checks (tests, linting, etc.)
    deps: [test, lint-check]
    cmds:
      - echo "âœ… All validation checks passed!"

  install-deps:
    desc: Install or update dependencies
    cmds:
      - echo "ğŸ“¥ Installing dependencies..."
      - uv sync
      - echo "âœ… Dependencies installed!"

  check-env:
    desc: Check development environment
    cmds:
      - echo "ğŸ” Checking development environment..."
      - echo "Python version:"
      - uv run python --version
      - echo "UV version:"
      - uv --version
      - echo "Project info:"
      - uv run python -c "import sys; print('Python executable:', sys.executable)"
      - echo "âœ… Environment check complete!"

  demo:
    desc: Run a quick demo of the validation utilities and puzzle system
    cmds:
      - echo "ğŸ® Running validation demo..."
      - uv run python -c "from game.validation import PrologValidator; result = PrologValidator.validate_fact('likes(alice, chocolate).'); print('Valid fact:', result.is_valid)"
      - uv run python -c "from game.validation import PrologValidator; result = PrologValidator.validate_fact('likes(alice, chocolate)'); print('Invalid fact (no period):', result.is_valid, '-', result.error_message)"
      - uv run python -c "from game.validation import PrologValidator; result = PrologValidator.validate_query('?- likes(alice, X).'); print('Valid query:', result.is_valid)"
      - uv run python -c "from game.validation import PrologValidator; result = PrologValidator.validate_query('likes(alice, X).'); print('Invalid query (no prefix):', result.is_valid, '-', result.error_message)"
      - echo "ğŸ§© Running puzzle system demo..."
      - uv run python -c "from game.puzzles import PuzzleManager, SimpleFactPuzzle; manager = PuzzleManager(); puzzle = SimpleFactPuzzle(); manager.register_puzzle(puzzle); manager.start_puzzle('simple_fact_1'); result = manager.submit_solution('likes(alice, chocolate).'); print('Puzzle solved:', result.success, 'Score:', result.score)"
      - uv run python -c "from game.puzzles import PuzzleManager, SimpleFactPuzzle; manager = PuzzleManager(); puzzle = SimpleFactPuzzle(); manager.register_puzzle(puzzle); manager.start_puzzle('simple_fact_1'); hint = manager.get_hint(); print('Hint system:', hint)"
      - echo "âœ… Demo complete!"

  ci:
    desc: Run CI pipeline (what would run in continuous integration)
    deps: [setup, validate, build]
    cmds:
      - echo "ğŸ¯ CI pipeline completed successfully!"